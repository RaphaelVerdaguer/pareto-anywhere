#!/usr/bin/env node

const ParetoAnywhere = require('../lib/paretoanywhere.js');
require('dotenv').config({ path: '../.env' });
const ElasticsearchTest = require("../lib/elasticsearchTest");

// ----- Exit gracefully if the optional dependency is not found -----
let BarnaclesElasticsearch;
try {
  BarnaclesElasticsearch = require('barnacles-elasticsearch');
}
catch(err) {
  console.log('This script requires the barnacles-elasticsearch package.  Try installing with:');
  console.log('\r\n    "npm install barnacles-elasticsearch"\r\n');
  return console.log('and then run this script again.');
}
// -------------------------------------------------------------------

const ELASTICSEARCH_NODE = "https://"+process.env.SERVER_IP+":"+process.env.ES_PORT ||
                           'https://localhost:9200';

// Create an instance of ElasticsearchTest
const elasticsearchTest = new ElasticsearchTest(ELASTICSEARCH_NODE);
elasticsearchTest.testConnection();

let pa = new ParetoAnywhere();

// Add the Elasticsearch interface
pa.barnacles.addInterface(BarnaclesElasticsearch, { clientOptions: elasticsearchTest.elasticsearchDataConApi });